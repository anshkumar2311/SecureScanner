import { Card, CardContent, CardDescription, CardHeader, CardTitle, CardFooter } from "@/components/ui/card"
import { Progress } from "@/components/ui/progress"
import { Shield, AlertTriangle, AlertCircle, Info, Clock, Server } from "lucide-react"
import { Badge } from "@/components/ui/badge"

interface VulnerabilityReportProps {
  results: {
    url: string
    scanDate: string
    scanDuration: string
    securityScore: number
    riskLevel: string
    vulnerabilitiesSummary: {
      high: number
      medium: number
      low: number
    }
    vulnerabilities: Array<{
      name: string
      severity: string
      description: string
      location: string
      evidence?: string
      cvss?: string
    }>
    recommendations: Array<{
      title: string
      description: string
      code?: string
      resources?: string[]
    }>
    technicalDetails: {
      headers: string
      technologies: string[]
      ports: Array<{
        number: number
        service: string
      }>
      dns: string
    }
  }
}

export function VulnerabilityReport({ results }: VulnerabilityReportProps) {
  const { url, scanDate, scanDuration, securityScore, riskLevel, vulnerabilitiesSummary } = results
  const totalVulnerabilities = vulnerabilitiesSummary.high + vulnerabilitiesSummary.medium + vulnerabilitiesSummary.low

  // Determine the color based on the security score
  const getScoreColor = () => {
    if (securityScore >= 80) return "text-green-500"
    if (securityScore >= 60) return "text-yellow-500"
    return "text-red-500"
  }

  // Determine the progress color based on the security score
  const getProgressColor = () => {
    if (securityScore >= 80) return "bg-green-500"
    if (securityScore >= 60) return "bg-yellow-500"
    return "bg-red-500"
  }

  return (
    <div className="grid gap-6">
      <Card>
        <CardHeader className="pb-2">
          <div className="flex justify-between items-start">
            <div>
              <CardTitle className="text-xl">Security Assessment Report</CardTitle>
              <CardDescription>{url}</CardDescription>
            </div>
            <Badge variant={riskLevel === "High" ? "destructive" : riskLevel === "Medium" ? "default" : "outline"}>
              {riskLevel} Risk
            </Badge>
          </div>
        </CardHeader>
        <CardContent>
          <div className="grid md:grid-cols-2 gap-6">
            <div>
              <div className="flex items-center justify-between mb-2">
                <h3 className="text-sm font-medium">Security Score</h3>
                <span className={`text-2xl font-bold ${getScoreColor()}`}>{securityScore}%</span>
              </div>
              <Progress value={securityScore} className={`h-2 ${getProgressColor()}`} />

              <div className="grid grid-cols-2 gap-4 mt-6">
                <div className="flex items-center gap-2">
                  <Clock className="h-4 w-4 text-muted-foreground" />
                  <div className="text-sm">
                    <p className="text-muted-foreground">Scan Date</p>
                    <p className="font-medium">{scanDate}</p>
                  </div>
                </div>
                <div className="flex items-center gap-2">
                  <Server className="h-4 w-4 text-muted-foreground" />
                  <div className="text-sm">
                    <p className="text-muted-foreground">Duration</p>
                    <p className="font-medium">{scanDuration}</p>
                  </div>
                </div>
              </div>
            </div>

            <div className="grid grid-cols-3 gap-3">
              <Card className="bg-red-50 dark:bg-red-950/20 border-red-200 dark:border-red-800">
                <CardContent className="p-4 flex flex-col items-center justify-center text-center">
                  <AlertCircle className="h-5 w-5 text-red-500 mb-1" />
                  <p className="text-2xl font-bold text-red-600 dark:text-red-400">{vulnerabilitiesSummary.high}</p>
                  <p className="text-xs text-red-600 dark:text-red-400">High Risk</p>
                </CardContent>
              </Card>
              <Card className="bg-yellow-50 dark:bg-yellow-950/20 border-yellow-200 dark:border-yellow-800">
                <CardContent className="p-4 flex flex-col items-center justify-center text-center">
                  <AlertTriangle className="h-5 w-5 text-yellow-500 mb-1" />
                  <p className="text-2xl font-bold text-yellow-600 dark:text-yellow-400">
                    {vulnerabilitiesSummary.medium}
                  </p>
                  <p className="text-xs text-yellow-600 dark:text-yellow-400">Medium Risk</p>
                </CardContent>
              </Card>
              <Card className="bg-blue-50 dark:bg-blue-950/20 border-blue-200 dark:border-blue-800">
                <CardContent className="p-4 flex flex-col items-center justify-center text-center">
                  <Info className="h-5 w-5 text-blue-500 mb-1" />
                  <p className="text-2xl font-bold text-blue-600 dark:text-blue-400">{vulnerabilitiesSummary.low}</p>
                  <p className="text-xs text-blue-600 dark:text-blue-400">Low Risk</p>
                </CardContent>
              </Card>
            </div>
          </div>
        </CardContent>
        <CardFooter className="border-t pt-6">
          <div className="w-full">
            <div className="flex items-center gap-2 mb-3">
              <Shield className="h-5 w-5 text-primary" />
              <h3 className="font-medium">Executive Summary</h3>
            </div>
            <p className="text-sm text-muted-foreground">
              {totalVulnerabilities === 0
                ? "The security assessment of the target did not identify any significant vulnerabilities. The website implements proper security controls and follows best practices. Regular security assessments are recommended to maintain this security posture."
                : `The security assessment identified ${totalVulnerabilities} potential vulnerabilities in the target system. 
                ${vulnerabilitiesSummary.high > 0 ? `The presence of ${vulnerabilitiesSummary.high} high-risk vulnerabilities indicates immediate remediation is required. ` : ""} 
                ${vulnerabilitiesSummary.medium > 0 ? `${vulnerabilitiesSummary.medium} medium-risk issues should be addressed in the near term. ` : ""}
                Implementing the recommended security controls will significantly improve the overall security posture.`}
            </p>
          </div>
        </CardFooter>
      </Card>
    </div>
  )
}

